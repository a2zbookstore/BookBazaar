<!DOCTYPE html>
<html>
<head>
    <title>Simple PayPal Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 15px 30px; background: #007cba; color: white; border: none; cursor: pointer; margin: 10px; }
        .result { margin: 20px 0; padding: 15px; background: #f0f0f0; }
        .error { background: #fdd; }
        .success { background: #dfd; }
        pre { background: #f8f8f8; padding: 10px; overflow-x: auto; font-size: 12px; }
        input { padding: 8px; margin: 5px; width: 200px; }
        label { display: block; margin: 10px 0 5px 0; }
    </style>
</head>
<body>
    <h1>Simple PayPal Test (No Complex Validation)</h1>
    
    <div>
        <label>Amount (USD):</label>
        <input type="number" id="amount" value="10.00" step="0.01">
        
        <label>Customer Name:</label>
        <input type="text" id="name" value="John Doe">
        
        <label>Email:</label>
        <input type="email" id="email" value="john@example.com">
        
        <label>Phone:</label>
        <input type="tel" id="phone" value="1234567890">
        
        <button onclick="createPayPalOrder()">Create PayPal Order (Simple)</button>
        <button onclick="testFrontendValidation()">Test Frontend Validation</button>
    </div>
    
    <div id="result" class="result">Click a button to test...</div>

    <script>
        async function createPayPalOrder() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Creating PayPal order...';
            
            const amount = document.getElementById('amount').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            try {
                console.log('üî¥ STARTING: Simple PayPal order creation...');
                
                // Simple validation
                if (!amount || parseFloat(amount) <= 0) {
                    throw new Error('Invalid amount');
                }
                if (!name || name.trim().length < 2) {
                    throw new Error('Invalid name');
                }
                if (!email || !email.includes('@')) {
                    throw new Error('Invalid email');
                }
                if (!phone || phone.length < 7) {
                    throw new Error('Invalid phone');
                }
                
                console.log('üü¢ VALIDATION: All fields valid');
                
                const paypalOrderData = {
                    amount: parseFloat(amount).toFixed(2),
                    currency: "USD",
                    intent: "CAPTURE",
                    return_url: window.location.origin + "/paypal-complete",
                    cancel_url: window.location.origin + "/checkout",
                    orderData: {
                        customerName: name,
                        customerEmail: email,
                        customerPhone: phone,
                        shippingAddress: {
                            street: "123 Test St",
                            city: "Test City",
                            state: "TS",
                            zipCode: "12345",
                            country: "United States"
                        },
                        subtotal: (parseFloat(amount) - 2.00).toFixed(2),
                        shipping: "2.00",
                        tax: "0.00",
                        total: parseFloat(amount).toFixed(2),
                        paymentMethod: "paypal"
                    }
                };
                
                console.log('üîµ REQUEST: Sending to /api/paypal/order');
                console.log('üîµ DATA:', paypalOrderData);
                
                const response = await fetch('/api/paypal/order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(paypalOrderData),
                });
                
                console.log('üîµ RESPONSE: Status', response.status, response.statusText);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üü¢ SUCCESS:', data);
                    
                    // Find approval URL
                    const approvalUrl = data.links?.find(link => link.rel === 'approve')?.href;
                    
                    if (approvalUrl) {
                        resultDiv.className = 'result success';
                        resultDiv.innerHTML = `
                            <strong>‚úÖ PayPal Order Created Successfully!</strong><br>
                            <strong>Order ID:</strong> ${data.id}<br>
                            <strong>Status:</strong> ${data.status}<br>
                            <strong>Approval URL:</strong> <a href="${approvalUrl}" target="_blank">Click to Pay</a><br>
                            <strong>Auto-redirect in 3 seconds...</strong><br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        `;
                        
                        // Auto redirect after 3 seconds
                        setTimeout(() => {
                            console.log('üîµ REDIRECT: Opening PayPal...');
                            window.open(approvalUrl, '_blank');
                        }, 3000);
                    } else {
                        throw new Error('No approval URL found in response');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('üî¥ ERROR:', errorText);
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
            } catch (error) {
                console.error('üî¥ CAUGHT ERROR:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>‚ùå Error!</strong><br>
                    <strong>Message:</strong> ${error.message}<br>
                    <strong>Type:</strong> ${error.name}<br>
                    <pre>${error.stack}</pre>
                `;
            }
        }
        
        async function testFrontendValidation() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing frontend validation logic...';
            
            const amount = document.getElementById('amount').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            console.log('üîµ TESTING: Frontend validation');
            
            const tests = [];
            
            // Test 1: Amount validation
            const amountValid = amount && parseFloat(amount) > 0;
            tests.push(`Amount (${amount}): ${amountValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            
            // Test 2: Name validation
            const nameValid = name && name.trim().length >= 2;
            tests.push(`Name (${name}): ${nameValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            
            // Test 3: Email validation
            const emailValid = email && email.includes('@') && email.includes('.');
            tests.push(`Email (${email}): ${emailValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            
            // Test 4: Phone validation
            const phoneValid = phone && phone.replace(/\D/g, '').length >= 7;
            tests.push(`Phone (${phone}): ${phoneValid ? '‚úÖ Valid' : '‚ùå Invalid'}`);
            
            // Test 5: Form overall validity
            const allValid = amountValid && nameValid && emailValid && phoneValid;
            tests.push(`Overall: ${allValid ? '‚úÖ All Valid' : '‚ùå Some Invalid'}`);
            
            resultDiv.className = allValid ? 'result success' : 'result error';
            resultDiv.innerHTML = `
                <strong>Frontend Validation Test Results:</strong><br>
                ${tests.join('<br>')}
                <br><br>
                <strong>Next Step:</strong> ${allValid ? 'Ready for PayPal' : 'Fix validation errors'}
            `;
            
            console.log('üîµ VALIDATION RESULTS:', tests);
        }
    </script>
</body>
</html>